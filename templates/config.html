{% extends "base.html" %}

{% block title %}系统配置 - 智泊管理{% endblock %}

{% block content %}
<div class="page-content">
<div class="page-title">
    <i class="fas fa-cogs"></i> 系统全局配置
</div>

<div class="row" >
    <div class="card">
        <div class="card-body">
            <h4 style="color: var(--primary-color); margin-bottom: 25px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                <i class="fas fa-sliders-h"></i> 参数设置
            </h4>

            <form method="POST" action="{{ url_for('system_config') }}">
                
                <div class="form-section" style="margin-bottom: 30px;">
                    <h5 style="font-size: 1rem; color: #5a5c69; margin-bottom: 15px; font-weight: 700;">
                        <i class="fas fa-brain" style="color: var(--info-color);"></i> 识别算法参数 (默认值)
                    </h5>
                    
                    <div class="form-group">
                        <label class="form-label">YOLO 置信度阈值 (Confidence)</label>
                        <div class="range-container" style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" class="form-range" name="conf_thres" 
                                   min="0.1" max="1.0" step="0.05" 
                                   value="{{ config.conf_thres }}" 
                                   oninput="document.getElementById('confVal').innerText = this.value"
                                   style="flex-grow: 1;">
                            <span id="confVal" class="range-value" style="font-weight: bold; color: var(--primary-color); width: 40px;">{{ config.conf_thres }}</span>
                        </div>
                        <small style="color: #858796; font-size: 0.8rem;">低于此分数的检测目标将被忽略</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">NMS IOU 阈值</label>
                        <div class="range-container" style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" class="form-range" name="iou_thres" 
                                   min="0.1" max="1.0" step="0.05" 
                                   value="{{ config.iou_thres }}"
                                   oninput="document.getElementById('iouVal').innerText = this.value"
                                   style="flex-grow: 1;">
                            <span id="iouVal" class="range-value" style="font-weight: bold; color: var(--primary-color); width: 40px;">{{ config.iou_thres }}</span>
                        </div>
                        <small style="color: #858796; font-size: 0.8rem;">用于去除重叠的检测框</small>
                    </div>
                </div>

                <hr style="border-top: 1px dashed #e3e6f0; margin: 20px 0;">

                <div class="form-section" style="margin-bottom: 30px;">
                    <h5 style="font-size: 1rem; color: #5a5c69; margin-bottom: 15px; font-weight: 700;">
                        <i class="fas fa-video" style="color: var(--warning-color);"></i> 监控设置
                    </h5>
                    
                    <div class="form-group">
                        <label class="form-label">摄像头地址 / 设备ID</label>
                        <div class="input-icon-wrapper" style="position: relative;">
                            <i class="fas fa-camera input-icon" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #b7b9cc;"></i>
                            <input type="text" name="camera_source" class="form-control" 
                                   value="{{ config.camera_source }}" 
                                   placeholder="例如: 0 或 rtsp://admin:123456@192.168.1.64..."
                                   style="padding-left: 40px;">
                        </div>
                        <small style="color: #858796; font-size: 0.8rem;">输入 0 使用本地默认相机，或输入 RTSP 流地址</small>
                    </div>
                </div>

                <hr style="border-top: 1px dashed #e3e6f0; margin: 20px 0;">

                <div class="form-section">
                    <h5 style="font-size: 1rem; color: #5a5c69; margin-bottom: 15px; font-weight: 700;">
                        <i class="fas fa-database" style="color: var(--success-color);"></i> 数据维护
                    </h5>
                    
                    <div class="form-group">
                        <label class="form-label">历史记录保留天数</label>
                        <div class="input-icon-wrapper" style="position: relative;">
                            <i class="fas fa-calendar-alt input-icon" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #b7b9cc;"></i>
                            <input type="number" name="retention_days" class="form-control" 
                                   value="{{ config.retention_days }}" 
                                   min="1" max="365"
                                   style="padding-left: 40px;">
                        </div>
                        <small style="color: #858796; font-size: 0.8rem;">超过此时长的识别记录及其图片将被自动清理</small>
                    </div>
                </div>

                <div class="form-actions" style="margin-top: 40px; text-align: right;">
                    
                    <button type="submit" class="btn-submit">
                        <i class="fas fa-save"></i> 保存配置
                    </button>
                    <button type="reset" class="btn-cancel" style="margin-right: 10px;">重置更改</button>
                </div>

            </form>
        </div>
    </div>
</div>
</div>
<style>
    .slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: .4s;
        border-radius: 50%;
    }
    input:checked + .slider {
        background-color: var(--primary-color);
    }
    input:checked + .slider:before {
        transform: translateX(26px);
    }
    
    /* 滑块轨道样式优化 */
    input[type=range] {
        -webkit-appearance: none; 
        background: transparent; 
    }
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
    }
    input[type=range]:focus {
        outline: none; 
    }
    
    /* Webkit (Chrome/Edge) */
    input[type=range]::-webkit-slider-runnable-track {
        width: 100%;
        height: 6px;
        cursor: pointer;
        background: #e3e6f0;
        border-radius: 3px;
    }
    input[type=range]::-webkit-slider-thumb {
        height: 18px;
        width: 18px;
        border-radius: 50%;
        background: var(--primary-color);
        cursor: pointer;
        -webkit-appearance: none;
        margin-top: -6px; /* 居中 */
        box-shadow: 0 0 2px rgba(0,0,0,0.2);
    }
</style>
{% endblock %}